{
  "nodes": [
    {
      "id": "u1",
      "type": "Input",
      "NL": "WTD / MTD / QTD / YTD Sales vs Target?",
      "Table": {},
      "operation": {
        "type": "Input",
        "condition": [],
        "activate_edges": []
      }
    },
    {
      "id": "r1",
      "type": "Rewrite",
      "NL": "\"Calculate the actual sales and sales targets for WTD, MTD, QTD, and YTD in 2025.\"",
      "Table": {},
      "operation": {
        "type": "Rewrite",
        "condition": [
          "2025",
          "WTD",
          "MTD",
          "QTD",
          "YTD",
          "actual sales",
          "sales target"
        ],
        "activate_edges": [
          "edge1"
        ]
      }
    },
    {
      "id": "k2",
      "type": "Keyword",
      "score": 0.25416481494903564,
      "keyword": "Week-to-Date (WTD)",
      "NL": "Week-to-Date (WTD): The date range from the first day (Sunday) of the current week to yesterday",
      "Table": {},
      "operation": {
        "type": "Keyword",
        "condition": [
          "Week-to-Date (WTD)"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_2"
        ]
      }
    },
    {
      "id": "k13",
      "type": "Keyword",
      "score": 0.13619261980056763,
      "keyword": "Week ID",
      "NL": "Week ID: {'description': \"A six-digit identifier in the 'yyyyww' format (e.g., '202505' for the 5th week of 2025)\", 'Rule for Year Assignment': ['If the current date is between April 1st and December 31st, use the current year + 1', 'If the current date is between January 1st and March 31st, use the current year'], 'SQL': 'SELECT week_id FROM chatbi_dim_calendar WHERE date_code = CURRENT_DATE'}",
      "Table": {},
      "operation": {
        "type": "Keyword",
        "condition": [
          "Week ID"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_13"
        ]
      }
    },
    {
      "id": "k6",
      "type": "Keyword",
      "score": 0.13377875089645386,
      "keyword": "Calendar Year-to-Date (C-YTD)",
      "NL": "Calendar Year-to-Date (C-YTD): Alias for YTD (From the first day of this year to yesterday)",
      "Table": {},
      "operation": {
        "type": "Keyword",
        "condition": [
          "Calendar Year-to-Date (C-YTD)"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_6"
        ]
      }
    },
    {
      "id": "k5",
      "type": "Keyword",
      "score": 0.09216320514678955,
      "keyword": "Year-to-Date (YTD)",
      "NL": "Year-to-Date (YTD): The date range from the first day of the current calendar year to yesterday",
      "Table": {},
      "operation": {
        "type": "Keyword",
        "condition": [
          "Year-to-Date (YTD)"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_5"
        ]
      }
    },
    {
      "id": "k3",
      "type": "Keyword",
      "score": 0.054920196533203125,
      "keyword": "Month-to-Date (MTD)",
      "NL": "Month-to-Date (MTD): The date range from the first day of the current month to yesterday",
      "Table": {},
      "operation": {
        "type": "Keyword",
        "condition": [
          "Month-to-Date (MTD)"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_3"
        ]
      }
    },
    {
      "id": "a1",
      "type": "Analysis",
      "NL": "Calculate the total actual sales and target sales for the time periods WTD (Week-to-Date), MTD (Month-to-Date), QTD (Quarter-to-Date), and YTD (Year-to-Date) in the year 2025. The current date is statically set to February 13, 2025, and the database only contains data from January 1, 2025, to March 1, 2025.",
      "Table": {},
      "operation": {
        "type": "AnalysisRewrite",
        "condition": [
          "2025",
          "WTD",
          "MTD",
          "QTD",
          "YTD",
          "actual sales",
          "target sales"
        ],
        "activate_edges": [
          "edge1",
          "edge_k_0",
          "edge_k_1",
          "edge_k_2",
          "edge_k_3",
          "edge_k_4"
        ]
      }
    },
    {
      "id": "s1",
      "father_id": [],
      "NL": "Initial query for WTD (Week-to-Date) period. Selects raw sales and target sales data from the dm_fact_sales_chatbi table where date_code falls within the current week up to the day before the static current date (2025-02-13).",
      "sql": "SELECT 'WTD' AS period, amt, amt_target FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('week', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day')",
      "condition": [
        "period",
        "amt",
        "amt_target"
      ],
      "type": "Select",
      "Table": {
        "data": [
          [
            "period",
            "amt",
            "amt_target"
          ],
          [
            "WTD",
            null,
            null
          ],
          [
            "WTD",
            60902,
            null
          ],
          [
            "WTD",
            64629400,
            77257802
          ],
          [
            "YTD",
            64629400,
            77257802
          ],
          [
            "MTD",
            64629400,
            77257802
          ],
          [
            "QTD",
            64629400,
            77257802
          ]
        ]
      },
      "operation": {
        "type": "Select",
        "condition": [
          "period",
          "actual_sales",
          "target_sales"
        ],
        "activate_edges": [
          "k2",
          "k13",
          "k6",
          "k5",
          "k3"
        ]
      }
    },
    {
      "id": "y2",
      "father_id": [
        "y1"
      ],
      "NL": "Adds aggregation to the YTD query to compute the total actual sales (amt) and total target sales (amt_target) within the year-to-date period.",
      "sql": "SELECT 'YTD' AS period, SUM(amt) AS actual_sales, SUM(amt_target) AS target_sales FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('year', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day')",
      "condition": [
        "actual_sales",
        "target_sales"
      ],
      "type": "Aggregate",
      "Table": {
        "data": [
          [
            "period",
            "actual_sales",
            "target_sales"
          ],
          [
            "YTD",
            64629400,
            77257802
          ]
        ]
      },
      "operation": {
        "type": "Aggregate",
        "condition": [
          "actual_sales",
          "target_sales"
        ],
        "activate_edges": [
          "k2",
          "k13",
          "k6",
          "k5",
          "k3"
        ]
      }
    },
    {
      "id": "m1",
      "father_id": [
        "s2",
        "t2",
        "q2",
        "y2"
      ],
      "NL": "Combines the results of the four independent time period queries (WTD, MTD, QTD, YTD) using UNION ALL to provide a unified result set with total actual and target sales for each time period.",
      "sql": "SELECT 'WTD' AS period, SUM(amt) AS actual_sales, SUM(amt_target) AS target_sales FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('week', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day') UNION ALL SELECT 'MTD' AS period, SUM(amt) AS actual_sales, SUM(amt_target) AS target_sales FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('month', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day') UNION ALL SELECT 'QTD' AS period, SUM(amt) AS actual_sales, SUM(amt_target) AS target_sales FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('quarter', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day') UNION ALL SELECT 'YTD' AS period, SUM(amt) AS actual_sales, SUM(amt_target) AS target_sales FROM dm_fact_sales_chatbi WHERE date_code::DATE BETWEEN (SELECT DATE_TRUNC('year', '2025-02-13'::DATE)::DATE) AND (SELECT '2025-02-13'::DATE - INTERVAL '1 day')",
      "condition": [
        "period",
        "actual_sales",
        "target_sales"
      ],
      "type": "Join",
      "Table": {
        "data": [
          [
            "period",
            "actual_sales",
            "target_sales"
          ],
          [
            "WTD",
            64629400,
            77257802
          ],
          [
            "YTD",
            64629400,
            77257802
          ],
          [
            "MTD",
            64629400,
            77257802
          ],
          [
            "QTD",
            64629400,
            77257802
          ]
        ]
      },
      "operation": {
        "type": "Join",
        "condition": [
          "period",
          "actual_sales",
          "target_sales"
        ],
        "activate_edges": [
          "k2",
          "k13",
          "k6",
          "k5",
          "k3"
        ]
      }
    }
  ],
  "edges": [
    {
      "edge_id": "edge1",
      "from": "u1",
      "to": "r1"
    },
    [
      {
        "edge_id": "edge_r_0",
        "from": "r1",
        "to": "k0"
      }
    ],
    [
      {
        "edge_id": "edge_r_1",
        "from": "r1",
        "to": "k1"
      }
    ],
    [
      {
        "edge_id": "edge_r_2",
        "from": "r1",
        "to": "k2"
      }
    ],
    [
      {
        "edge_id": "edge_r_3",
        "from": "r1",
        "to": "k3"
      }
    ],
    [
      {
        "edge_id": "edge_r_4",
        "from": "r1",
        "to": "k4"
      }
    ],
    {
      "edge_id": "edge_s_0",
      "from": "a1",
      "to": "s1"
    },
    {
      "edge_id": "edge_s_1",
      "from": "s1",
      "to": "s2"
    },
    {
      "edge_id": "edge_s_2",
      "from": "s2",
      "to": "t1"
    },
    {
      "edge_id": "edge_s_3",
      "from": "t1",
      "to": "t2"
    },
    {
      "edge_id": "edge_s_4",
      "from": "t2",
      "to": "q1"
    },
    {
      "edge_id": "edge_s_5",
      "from": "q1",
      "to": "q2"
    },
    {
      "edge_id": "edge_s_6",
      "from": "q2",
      "to": "y1"
    },
    {
      "edge_id": "edge_s_7",
      "from": "y1",
      "to": "y2"
    },
    {
      "edge_id": "edge_s_8",
      "from": [
        "s2",
        "t2",
        "q2",
        "y2"
      ],
      "to": "m1"
    }
  ]
}